CREATE TABLE FACT_SALES (
    SALES_KEY        NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TRANSACTION_ID   VARCHAR2(50),
    CUSTOMER_KEY     NUMBER,
    PRODUCT_KEY      NUMBER,
    DATE_KEY         NUMBER,
    QUANTITY         NUMBER,
    PRICE_PER_UNIT   NUMBER(10,2),
    TOTAL_AMOUNT     NUMBER(12,2)
);

-- Populate FACT_SALES
INSERT INTO FACT_SALES (TRANSACTION_ID, CUSTOMER_KEY, PRODUCT_KEY, DATE_KEY, QUANTITY, PRICE_PER_UNIT, TOTAL_AMOUNT)
SELECT
    st.TRANSACTION_ID,
    c.CUSTOMER_KEY,
    p.PRODUCT_KEY,
    d.DATE_KEY,
    st.QUANTITY,
    st.PRICE_PER_UNIT,
    st.TOTAL_AMOUNT
FROM STG_RETAIL_TRANSACTIONS st
JOIN DIM_CUSTOMER c ON st.CUSTOMER_ID = c.CUSTOMER_ID
JOIN DIM_PRODUCT p ON st.PRODUCT_CATEGORY = p.PRODUCT_CATEGORY
JOIN DIM_DATE d ON TO_DATE(st.TRANSACTION_DATE,'YYYY-MM-DD') = d.FULL_DATE;
