-- DIM_CUSTOMER
CREATE TABLE DIM_CUSTOMER (
    CUSTOMER_KEY NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CUSTOMER_ID  VARCHAR2(50),
    GENDER       VARCHAR2(10),
    AGE          NUMBER
);

-- DIM_PRODUCT
CREATE TABLE DIM_PRODUCT (
    PRODUCT_KEY      NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PRODUCT_CATEGORY VARCHAR2(100)
);

-- DIM_DATE
CREATE TABLE DIM_DATE (
    DATE_KEY  NUMBER PRIMARY KEY,
    FULL_DATE DATE,
    YEAR      NUMBER,
    MONTH     NUMBER,
    DAY       NUMBER,
    WEEKDAY   VARCHAR2(20)
);

-- Populate DIM_CUSTOMER
INSERT INTO DIM_CUSTOMER (CUSTOMER_ID, GENDER, AGE)
SELECT DISTINCT CUSTOMER_ID, GENDER, AGE
FROM STG_RETAIL_TRANSACTIONS;

-- Populate DIM_PRODUCT
INSERT INTO DIM_PRODUCT (PRODUCT_CATEGORY)
SELECT DISTINCT PRODUCT_CATEGORY
FROM STG_RETAIL_TRANSACTIONS;

-- Populate DIM_DATE
INSERT INTO DIM_DATE (DATE_KEY, FULL_DATE, YEAR, MONTH, DAY, WEEKDAY)
SELECT
    TO_NUMBER(TO_CHAR(TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),'YYYYMMDD')),
    TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),
    TO_NUMBER(TO_CHAR(TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),'YYYY')),
    TO_NUMBER(TO_CHAR(TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),'MM')),
    TO_NUMBER(TO_CHAR(TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),'DD')),
    TO_CHAR(TO_DATE(TRANSACTION_DATE,'YYYY-MM-DD'),'DAY')
FROM STG_RETAIL_TRANSACTIONS
GROUP BY TRANSACTION_DATE;